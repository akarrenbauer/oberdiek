#!/bin/bash

# build oberdiek ctan distrib
# perhaps use l3build one day, but not today


# starting from oberdiek.zip and oberdiek.tds.zip from ctan


#
# cleanup
rm -r bibtex doc scripts source tex
mv oberdiek.pdf oberdiek.pdf-
rm *.pdf
mv oberdiek.pdf- oberdiek.pdf

# unzip oberdiek.tds.zip to generate initial tds structure
unzip ../oberdiek.tds.zip


# unpack
#
tex oberdiek.ins

# make pdf
for i in *.dtx
do
pdflatex ${i}
pdflatex ${i}
makeindex -s gind.ist ${i/.dtx/.idx}
pdflatex ${i}
done

# keep existing one for now
#pdflatex oberdiek
#pdflatex oberdiek
# runs forever on my machine biber oberdiek
#pdflatex oberdiek

# special cases
cp ./doc/latex/oberdiek/test/ifpdf-test1.tex .
cp ./doc/latex/oberdiek/test/ifpdf.xml .
cp README readme-ctan.txt
rm -f ./tex/latex/oberdiek/foo.sty

# fill tds tree
for i in `find bibtex doc scripts source tex -type f `
do
    cp `basename $i` $i
done

echo making tds zip

rm -f ../oberdiek.tds.zip
zip -r ../oberdiek.tds.zip \
    bibtex doc scripts source tex

cd ..
echo making main zip
rm oberdiek.zip
zip oberdiek.zip oberdiek.tds.zip oberdiek/\
{README,\
*.pdf,\
*.dtx\
}


